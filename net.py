#!/usr/bin/python

import config
import json
import requests

github_auth = None


def set_github_auth():
    global github_auth
    github_auth = \
            requests.auth.HTTPBasicAuth(config.gusername, config.gpassword)

def get_api_url(user, repo):
    t = "https://api.github.com/repos/{0}/{1}/contents"
    return t.format(user, repo)

def get_raw_resource(url, auth):
    req = requests.get(url, auth=auth)
    if req.status_code != 200:
        raise Exception("server replied with {0}. Text: {1}".format(
            req.status_code, req.text))
    return req.text

def get_json_resource(url, auth):
    return json.loads(get_raw_resource(url, auth))


def download_file(url, local_path):
    r = requests.get(url, stream=False)
    with open(local_path, "wb") as f:
        for chunk in r.iter_content(chunk_size=1024):
            if chunk:
                f.write(chunk)
