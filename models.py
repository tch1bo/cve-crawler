#!/usr/bin/python

import sqlalchemy as sa
from sqlalchemy.orm import relationship, backref
from sqlalchemy.ext.declarative import declarative_base

Base = declarative_base()

cve_url_table = sa.Table("cves_to_urls", Base.metadata,
        sa.Column("cve_id", sa.Integer, sa.ForeignKey("cves.id")),
        sa.Column("url_id", sa.Integer, sa.ForeignKey("urls.id")),
)

class CVE(Base):
    __tablename__ = "cves"
    sort_field = "cve_string"

    id = sa.Column(sa.Integer, primary_key=True)
    cve_string = sa.Column(sa.String(20), unique=True, nullable=False)

    urls = relationship("URL", secondary=cve_url_table, backref="cves")
    working_url = relationship("URL", backref="works_for_cve")

    def __repr__(self):
        return self.cve_string

class URL(Base):
    __tablename__ = "urls"
    sort_field = "url"

    id = sa.Column(sa.Integer, primary_key=True)
    url = sa.Column(sa.String(100), unique=True, nullable=False)

    works_for_cve_with_id = sa.Column(sa.Integer, sa.ForeignKey("cves.id"))

    def __repr__(self):
        return "URL: '{0}'".format(self.url)

